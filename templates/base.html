{% load staticfiles %}

<!doctype html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
      <title>{% block page_title %}YProgrammer{% endblock %}</title>
      <link type="text/css" rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
      <link type="text/css" rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
      <link type="text/css" rel="stylesheet" href="{% static 'resources/css/page.css' %}">
      <script src="{% static 'js/jquery-2.0.3.min.js' %}"></script>
      <script src="{% static 'js/jquery.cookie.js' %}"></script>
      <script src="{% static 'js/bootstrap.min.js' %}"></script>
      <script src="{% static 'js/yprogrammer.js' %}"></script>
      <link rel="Shortcut Icon" href="{% static 'img/yp.ico' %}" type="image/x-icon">
   </head>

   <body id="{% block page_id %}{% endblock %}">
      <script type="text/javascript">
      function csrfSafeMethod(method) {
         return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
      }
      
      // on each XMLHttpRequest, set a custom X-CSRFToken header to the value of the CSRF token.
      $.ajaxSetup({
         crossDomain: false, // obviates need for sameOrigin test
         beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type)) {
               xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken'));
            }
         }
      });
      </script>

      <div class="navbar navbar-inverse">
         <div class="navbar-inner">
            <div class="container">
               <a class="brand" href="{% url 'index' %}">YProgrammer</a>

               <ul class="nav">
                  {% if request.session.user  %}
                  <li><a href="{% url 'user_nav' %}">导航</a></li>
                  {% endif %}

                  <li><a href="{% url 'resources' %}">资源</a></li>
                  <li><a href="{% url 'my_nodes' %}">节点</a></li>

                  {% if request.session.user  %}
                  <li><a href="#">反馈</a></li>
                  {% endif %}
               </ul>

               {% if request.session.user  %}
               <ul class="nav pull-right">
                  <!-- <li><a class='btn-add-resource' href="#"><i class='icon-plus'></i> 添加资源</a></li> -->
                  <li>
                     <a href="{% url 'user' request.session.user %}">
                        <img id='user-avatar' src="{{ request.session.user_avatar }}">{{ request.session.user }}
                     </a>
                  </li>
                  <li>
                     <a href="#" title='Account settings'><i class='icon-cog'></i></a>
                  </li>
                  <li>
                     <a href="{% url 'signout' %}" title='Sign out'><i class='icon-off'></i></a>
                  </li>
               </ul>

<!--                <a class='btn btn-small pull-right btn-add-resource' href="#"><i class='icon-plus'></i> 添加资源</a>
               <div id="modal-add-resource" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-header">
                     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                     <h3 id="myModalLabel">添加资源</h3>
                  </div>
                  <form method='post' action="{% url 'add_resource' %}">
                     {% csrf_token %}
                     <div class="modal-body">
                        <input type='text' name='url' placeholder='URL' />
                        <input type='text' name='title' placeholder='标题' />
                        <input type='text' name='desc' placeholder='描述' />

                        <div>
                           <select name='node'></select>
                           <span class='select-divider'>/</span> 
                           <select name='type'></select>
                           <a href="#">添加类别</a>
                        </div>

                     </div>
                     <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                        <button class="btn btn-primary" type='submit'>添加</button>
                     </div>
                  </form>
               </div> -->
               <script type="text/javascript">
               // $(function(){
               //    var nodes = [];
               //    var select_nodes = $("#modal-add-resource select[name='node']");
               //    var select_types = $("#modal-add-resource select[name='type']");

               //    $('.btn-add-resource').click(function(){
               //       $.ajax({
               //          url: "",
               //          type: 'POST',
               //          dataType: 'json',
               //          success: function(result){
               //             nodes = result;
               //             $(select_nodes).empty();
               //             $.each(nodes, function(index, node){
               //                $(select_nodes).append("<option value=" + node.id + ">" + node.title + "</option>");

               //                if(index == 0){
               //                   $(select_types).empty();
               //                   $.each(node.types, function(index, type){
               //                      $(select_types).append("<option value=" + type.id + ">" + type.type + "</option>");
               //                   });
               //                }
               //             });
               //          }
               //       });
                     
               //       $(select_nodes).change(function(){
               //          var node_id = $(this)[0].options[$(this)[0].selectedIndex].value;

               //          $.each(nodes, function(index, node){
               //             if(node.id == node_id){
               //                $(select_types).empty();
               //                $.each(node.types, function(index, type){
               //                   $(select_types).append("<option value=" + type.id + ">" + type.type + "</option>");
               //                });
               //             }
               //          });
               //       });
                     
               //       $('#modal-add-resource').modal();
               //    });
               // })
               </script>
               {% else %}
               <a href="https://github.com/login/oauth/authorize?client_id=7a68fc19935c680f8e2e&redirect_uri=http://localhost:8000/signin/github" class='btn pull-right' href=""><i class='icon-github'></i> GitHub 登录</a>
               {% endif %}
            </div>
         </div>
      </div>

      <div id="main-wap" class="container">
      {% block body %}{% endblock %}
      </div>

      <div id="full-main-wap">
      {% block full-body %}{% endblock %}
      </div>

      <div id="footer">
         <div class='container'>
            <div id='copyright'>YProgrammer ©2013 by <a href="http://hustlzp.com" target="_blank">hustlzp</a></div>
            
            <ul id='links'>
               <!-- <li><a href="#">关于</a></li> -->
               <li><a target="_blank" href="https://github.com/hustlzp/yprogrammer">GitHub</a></li>
            </ul>
         </div>
      </div>
   </body>
</html>