{% extends 'base.html' %}

{% block page_id %}page-my-nodes{% endblock %}
{% block page_title %}Nodes{% endblock %}
{% block body %}

<script type="text/javascript">
$(function(){
   $('.btn-collect, .btn-discollect').click(function(){
      var r_id = $(this).data('resource-id');
      
      if($(this).hasClass('btn-collect')){
         var url = "{% url 'collect_resource' %}";
      } else {
         var url = "{% url 'discollect_resource' %}";
      }

      var btn_collect = $(this);

      $.ajax({
         url: url,
         method: 'POST',
         dataType: 'json',
         data: {
            'r_id': r_id,
            'csrfmiddlewaretoken': $.cookie('csrftoken')
         },
         success: function(result){
            if(result['result'] == 'success'){
               if($(btn_collect).hasClass('btn-collect')){
                  $(btn_collect).parent().addClass('on');
               } else {
                  $(btn_collect).parent().removeClass('on');
               }
            }
         }
      });
   });

});
</script>

<div class="row">
   <div class="span8">
      <div class="page-header">
         <h3>节点动态</h3>
      </div>

      <div class='node-list'>
         {% for nf in node_follows %}
         <div class='node-item media'>
            <a href="{% url 'node' nf.node.id %}" class='pull-left'>
               <img class='node-image media-object' src="{{ nf.node.image_url }}">
            </a>

            <div class='media-body'>
               <h4 class='media-heading'><a href="{% url 'node' nf.node.id %}" >{{ nf.node.title }}</a></h4>
               {% for r in nf.resources %}
               <div class='r-item'>
                  <a href='{{ r.url }}' class='r-title' target='_blank'>{{ r.title }}</a
                  ><small>
                     <span class='r-desc'>{{ r.desc }}</span>
                     <span class='r-time'>36分钟前</span>

                     <div class='collect-wap {% if r.is_collected %}on{% endif %}'>
                        <a class="btn-discollect" data-resource-id='{{ r.id }}' title='取消导航'><i class='icon-bookmark'></i></a>
                        <a class="btn-collect" data-resource-id='{{ r.id }}' title='添加到导航'><i class='icon-bookmark-empty'></i></a>
                     </div>
                  </small>
               </div>
               {% endfor %}

               <a class='btn-disfollow' href="{% url 'disfollow_node' nf.node.id %}">取消关注</a>
            </div>
         </div>
         {% endfor %}
      </div>
   </div>

   <div class="span4">
      <a href="{% url 'all_nodes' %}" class="btn btn-primary">全部节点</a>

      <div class="sidebar-header">
         <h4></h4>
      </div>
   </div>
</div>

{% endblock %}