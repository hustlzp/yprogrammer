{% extends 'base.html' %}

{% block page_id %}page-resource{% endblock %}
{% block page_title %}{{ resource.title }}{% endblock %}
{% block body %}

{% load is_collected from resource_tags %}

<script type="text/javascript">
$(function(){
   // collect resource by Ajax
   $('.btn-collect').click(function(){
      var r_id = $(this).data('resource-id');
      var url = "{% url 'collect_resource' %}";
      var btn_collect = $(this);

      ajax_collect_resource(url, r_id, function(){
         var collect_count = $(btn_collect).nextAll('.collect-count');
         $(btn_collect).parent().addClass('on');
         collect_count.text(parseInt(collect_count.text()) + 1);
      });
   });

   // discollect resource by Ajax
   $('.btn-discollect').click(function(){
      var r_id = $(this).data('resource-id');
      var url = "{% url 'discollect_resource' %}";
      var btn_discollect = $(this);

      ajax_collect_resource(url, r_id, function(){
         var collect_count = $(btn_discollect).nextAll('.collect-count');
         $(btn_discollect).parent().removeClass('on');
         collect_count.text(parseInt(collect_count.text()) - 1);
      });
   });

});
</script>

<div class="row">
   <div class="span8">
      <div class="page-header">
         <h2>{{ resource.title }}</h2>
         <p>{{ resource.desc }}</p>
         <p class='r-meta'>
            <a href="{% url 'node' resource.node.id %}">{{ resource.node.title }}</a> / {{ resource.type.type }}
            <span class='divider'></span>
            <i class='icon-user'></i> <a href="{% url 'user' resource.creator.name %}">{{ resource.creator.name }}</a>
            <span class='divider'></span>
            <i class='icon-external-link-sign'></i> <a href="{{ resource.url }}" target="_blank">{{ resource.url }}</a>
         </p>
      </div>

      <div class='sub-header'>
         <h4>评论 / 4</h4>
      </div>      
   </div>

   <div class="span4">
      <div class='btn-toolbar'>
         <div class='btn-group collect-container {% if resource|is_collected:request.session.user_id %}on{% endif %}'>
            <a class='btn btn-collect' data-resource-id={{ resource.id }} title='添加到导航'><i class='icon-bookmark-empty icon-white'></i></a>
            <a class='btn btn-primary btn-discollect' data-resource-id={{ resource.id }} title='取消导航'><i class='icon-bookmark'></i></a>
            <a class='btn collect-count'>{{ resource.collect_count }}</a>
         </div>
      </div>

      <div class="sidebar-header">
         <h4></h4>
      </div>
   </div>
</div>

{% endblock %}